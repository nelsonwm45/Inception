; -----------------------------------------------------------
; SECTION: Pool Definition
; -----------------------------------------------------------
; Start a new pool named 'www'.
; Defines the name of this pool of worker processes.
; PHP-FPM needs at least one pool to run.
[www]

; -----------------------------------------------------------
; SECTION: Process User/Group
; -----------------------------------------------------------
; Unix user/group of processes
; Defines which Linux user and group the PHP-FPM worker processes will run as.
; On Debian, the standard user for web services is 'www-data'.
; The WordPress files in '/var/www/html' (mounted via volume) are typically owned by 'www-data'.
; If this is set to 'root' or a different user, 
; 	PHP won't be able to write files (like uploading images or updating plugins), causing WordPress to crash
user = www-data
group = www-data


; -----------------------------------------------------------
; SECTION: Network Connection (The most important part for Docker)
; -----------------------------------------------------------
; Tells PHP-FPM to listen for network connections on all IP addresses (0.0.0.0) at port 9000.
; By default, PHP-FPM usually listens on a file socket ('/run/php/php7.4-fpm.sock').\
; Sockets ONLY work if NGINX and PHP are in the SAME container (files are local).
; Since three services is in different container, NGINX cannot read a socket file inside the WordPress container.
; It must communicate via TCP/IP over the Docker network.
; '0.0.0.0' is required to accept connections from outside the container (i.e., from the NGINX container).
listen = 0.0.0.0:9000

; -----------------------------------------------------------
; SECTION: Socket Permissions
; -----------------------------------------------------------
; Set permissions for listening socket
; When using TCP ports (like 9000 above), these file permissions are ignored by the kernel for the network connection itself.
; However, it is strictly required if you ever revert to using a Unix socket.
; Keeping them ensures configuration consistency and prevents errors if the process tries to manipulate its own state files.
listen.owner = www-data
listen.group = www-data


; -----------------------------------------------------------
; SECTION: Process Manager (PM) - Memory Management
; -----------------------------------------------------------
; Determines how worker processes are created.
;   - 'static': Fixed number of processes (good for high RAM).
;   - 'ondemand': Spawns only when requested (saves RAM, slower start).
;   - 'dynamic': Keeps a few processes alive, spawns more as traffic increases.
; The VM for this project usually has limited RAM (e.g., 4GB or less). 'dynamic' ensures the server is responsive (has workers ready) but doesn't eat all
pm = dynamic

; The maximum number of child processes to be created.
; Each PHP process consumes RAM (approx 30-50MB). 
; If you allow 50 children, 50 * 50MB = 2.5GB RAM. This could crash your VM.
; Setting this to 5 limits usage to ~250MB, leaving room for MariaDB and the OS.
pm.max_children = 5

; The number of child processes created on startup/container boots.
; Ensures the first user who visits the site doesn't have to wait for a process to spawn.
pm.start_servers = 2

; The desired minimum number of idle server processes.
; Ensures there is always at least one worker ready to take a request immediately.
pm.min_spare_servers = 1

; The desired maximum number of idle server processes.
; If traffic drops after a spike, this kills off extra processes to free up RAM for other services (like the Database).
pm.max_spare_servers = 3